<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Highlighter</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
    <!-- Top Toolbar -->
    <div class="toolbar">
        <div class="toolbar-left">
            <div class="app-title-group">
            <h1>ğŸ“š Grammar Highlighter</h1>
                <div class="dropdown">
                    <button class="dropbtn">File</button>
                    <div class="dropdown-content">
                        <button type="button" id="openFileBtn" class="dropdown-item-btn">ğŸ“‚ Open File...</button>
                        <!-- <button type="button" id="importYoutubeBtn" class="dropdown-item-btn">ğŸ¥ Import YouTube Transcript...</button> -->
                        <button type="button" id="syncDriveBtn" class="dropdown-item-btn">â˜ï¸ Sync with Drive</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="toolbar-center">
            <!-- Buttons moved to File menu -->
        </div>
        <div class="toolbar-right">
            <span id="fileNameDisplay">No file loaded</span>
        </div>
    </div>

    <!-- Document Tabs -->
    <div id="documentTabs" class="document-tabs" style="display: none;"></div>

    <!-- Main Content Area -->
    <div class="main-container">
        <!-- Library Sidebar (Left-most panel) -->
        <div class="library-panel" id="libraryPanel">
            <div id="libraryView" class="library-view">
                <!-- Library UI will be rendered here -->
            </div>
        </div>
        
        <!-- Expand Library Button (shown when collapsed) -->
        <button id="expandLibraryBtn" class="expand-panel-btn hidden" title="Expand Library">â˜°</button>
        
        <!-- Resizer between Library and Document Viewer -->
        <div class="resizer" id="libraryResizer"></div>
        
        <!-- Expand Viewer Button (shown when collapsed) -->
        <button id="expandViewerBtn" class="expand-panel-btn hidden" title="Expand Viewer">â˜°</button>
        
        <!-- Left Panel: Document Viewer -->
        <div class="pdf-panel" id="pdfPanel">
            <div class="panel-header">
                <h2 style="display: flex; align-items: center;">
                    <button id="collapseViewerBtn" class="panel-collapse-btn" title="Collapse Viewer">â˜°</button>
                    <span id="viewerTitle">ğŸ“„ Document Viewer</span>
                </h2>
                <div class="pdf-controls">
                    <button id="prevPageBtn" class="btn-icon" disabled>â—€</button>
                    <span id="pageInfo" class="page-info-container">
                        Page <input type="number" id="pageInput" class="page-input" value="1" min="1"> / <span id="totalPagesDisplay">-</span>
                    </span>
                    <button id="nextPageBtn" class="btn-icon" disabled>â–¶</button>
                    <button id="zoomOutBtn" class="btn-icon">ğŸ”-</button>
                    <span id="zoomLevel">100%</span>
                    <button id="zoomInBtn" class="btn-icon">ğŸ”+</button>
                    <button id="snipBtn" class="btn-icon" data-tooltip="Snip Tool: Manually select tables, charts, or diagrams">âœ‚ï¸</button>
                    <button id="epubSettingsBtn" class="btn-icon" style="display: none;" data-tooltip="EPUB Display Settings">âš™ï¸</button>
                </div>
                
                <!-- EPUB Settings Popup -->
                <div id="epubSettingsPopup" class="text-settings-popup hidden">
                    <div class="settings-header">
                        <h4>ğŸ“– EPUB Display Settings</h4>
                        <button id="closeEpubSettingsBtn" class="close-settings-btn">Ã—</button>
                    </div>
                    <div class="settings-body">
                        <div class="setting-group">
                            <label>Theme:</label>
                            <div class="theme-options">
                                <button class="theme-btn active" data-theme="light">â˜€ï¸ Light</button>
                                <button class="theme-btn" data-theme="sepia">ğŸ“œ Sepia</button>
                                <button class="theme-btn" data-theme="dark">ğŸŒ™ Dark</button>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label>Font Size:</label>
                            <div class="range-control">
                                <span class="range-label-sm">A</span>
                                <input type="range" id="epubFontSize" min="12" max="24" value="16" step="1">
                                <span class="range-label-lg">A</span>
                                <span id="epubFontSizeValue" style="margin-left: 10px; font-size: 12px; color: #666;">16px</span>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label>Font Family:</label>
                            <select id="epubFontFamily" class="font-select">
                                <option value="Georgia, serif">Georgia (Serif)</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="Arial, sans-serif">Arial (Sans-serif)</option>
                                <option value="'Segoe UI', sans-serif">Segoe UI</option>
                                <option value="'Courier New', monospace">Courier New (Mono)</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label>Line Height:</label>
                            <div class="range-control">
                                <input type="range" id="epubLineHeight" min="1.2" max="2.0" value="1.6" step="0.1">
                                <span id="epubLineHeightValue" style="margin-left: 10px; font-size: 12px; color: #666;">1.6</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="pdfViewerContainer" class="pdf-viewer-container">
                <!-- PDF Loading Overlay -->
                <div id="pdfLoadingOverlay" class="pdf-loading-overlay hidden">
                    <div class="pdf-loading-content">
                        <div class="loading-spinner"></div>
                        <div class="pdf-loading-text">Loading viewer...</div>
                    </div>
                </div>
                
                <div id="pdfCanvas" class="pdf-canvas-wrapper">
                    <div class="welcome-message">
                        <div class="welcome-icon">ğŸ“‚</div>
                        <h3>Welcome to Grammar Highlighter!</h3>
                        <p>Click "Open File" to get started</p>
                        
                        <!-- Open File Button -->
                        <button id="welcomeOpenFileBtn" class="btn btn-primary welcome-open-btn">ğŸ“‚ Open File</button>
                        
                        <!-- Recent PDFs -->
                        <div id="recentPdfsSection" class="recent-pdfs-section">
                            <h4>ğŸ“‹ Recent Documents</h4>
                            <div id="recentPdfsList" class="recent-pdfs-list">
                                <div class="no-recent-files">No recent files</div>
                            </div>
                        </div>
                        
                        <div class="features-list">
                            <div class="feature-item">âœ“ PDF Text Extraction</div>
                            <div class="feature-item">âœ“ OCR for Image-based PDFs</div>
                            <div class="feature-item">âœ“ Grammar Analysis</div>
                            <div class="feature-item">âœ“ Smart Highlighting</div>
                        </div>
                    </div>
                    <canvas id="pdfCanvasElement"></canvas>
                </div>
            </div>
        </div>

        <div class="resizer" id="resizer1"></div>

        <!-- Expand Text Button (shown when collapsed) -->
        <button id="expandTextBtn" class="expand-panel-btn hidden" title="Expand Extracted Text">â˜°</button>
        
        <!-- Middle Panel: Text Display -->
        <div class="text-panel" id="textPanel">
            <div class="panel-header">
                <h2 style="display: flex; align-items: center;">
                    <button id="collapseTextBtn" class="panel-collapse-btn" title="Collapse Extracted Text">â˜°</button>
                    <span>ğŸ“ Extracted Text</span>
                </h2>
                <div class="view-toggle">
                    <button id="highlightedTextBtn" class="btn-toggle active">Analyse</button>
                    <button id="notesBtn" class="btn-toggle">ğŸ“Œ Notes</button>
                    <button id="translateTabBtn" class="btn-toggle">ğŸŒ Translate</button>
                    <button id="mapBtn" class="btn-toggle">ğŸ—ºï¸ Map</button>
                    <button id="mindmapBtn" class="btn-toggle">ğŸ§  Mindmap</button>
                    <button id="figuresBtn" class="btn-toggle">ğŸ–¼ï¸ Figures</button>
                    <!-- <button id="showStatsTabBtn" class="btn-toggle" style="margin-left: 10px; border-left: 1px solid rgba(0,0,0,0.1);">ğŸ“Š Stats</button> -->
                </div>
            </div>

            <!-- Hidden Raw Text Container (used internally for text processing) -->
            <div id="rawTextContent" style="display: none;"></div>

            <!-- Highlighted Text View (Analyse Tab) -->
            <div id="highlightedTextView" class="text-view active">
                <div class="notes-toolbar">
                    <div class="continuous-mode-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" class="continuous-mode-checkbox">
                            <span class="slider round"></span>
                        </label>
                        <span class="toggle-label">Continuous Mode</span>
                        
                        <div class="color-picker-container hidden">
                            <div class="color-option selected" data-color="#FFC107" style="background-color: #FFC107;" title="Yellow"></div>
                            <div class="color-option" data-color="#4CAF50" style="background-color: #4CAF50;" title="Green"></div>
                            <div class="color-option" data-color="#2196F3" style="background-color: #2196F3;" title="Blue"></div>
                            <div class="color-option" data-color="#E91E63" style="background-color: #E91E63;" title="Pink"></div>
                            <div class="color-option" data-color="#9C27B0" style="background-color: #9C27B0;" title="Purple"></div>
                        </div>
                    </div>
                    <div class="page-navigator">
                        <label for="highlightedTextPageNav" style="font-size: 13px; color: #666;">Page:</label>
                        <input type="number" id="highlightedTextPageNav" class="page-nav-input" min="1" placeholder="1">
                        <button class="btn-icon page-nav-btn" title="Go to page">â†’</button>
                    </div>
                    <button class="btn-icon text-settings-btn" title="Text Appearance" style="margin-left: auto;">Aa</button>
                </div>
                <div class="highlight-options">
                    <label style="font-weight: 600; border-bottom: 1px solid #e0e0e0; padding-bottom: 6px; margin-bottom: 8px; width: 100%;"><input type="checkbox" id="highlightSelectAll" checked> âœ“ Select All</label>
                    
                    <!-- Basic Parts of Speech Section -->
                    <div class="pos-section">
                        <div class="pos-section-header" onclick="togglePOSSection('basicPOS')">
                            <span class="pos-section-arrow" id="basicPOS-arrow">â–¼</span>
                            <span style="font-weight: 600;">ğŸ“š Basic Parts of Speech</span>
                        </div>
                        <div class="pos-section-content" id="basicPOS-content">
                            <label><input type="checkbox" id="highlightNouns" checked> ğŸ”µ Nouns <span class="pos-count" id="countNouns">-</span></label>
                            <label><input type="checkbox" id="highlightVerbs" checked> ğŸŸ¢ Verbs <span class="pos-count" id="countVerbs">-</span></label>
                            <label><input type="checkbox" id="highlightAdj"> ğŸŸ¡ Adjectives <span class="pos-count" id="countAdj">-</span></label>
                            <label><input type="checkbox" id="highlightAdv"> ğŸŸ  Adverbs <span class="pos-count" id="countAdv">-</span></label>
                            <label><input type="checkbox" id="highlightPrep"> ğŸŸ£ Prepositions <span class="pos-count" id="countPrep">-</span></label>
                            <label><input type="checkbox" id="highlightConj"> ğŸŸ¤ Conjunctions <span class="pos-count" id="countConj">-</span></label>
                            <label><input type="checkbox" id="highlightInterj"> ğŸ”´ Interjections <span class="pos-count" id="countInterj">-</span></label>
                            <label><input type="checkbox" id="highlightDet"> âšª Determiners <span class="pos-count" id="countDet">-</span></label>
                        </div>
                    </div>
                    
                    <!-- Named Entities Section -->
                    <div class="pos-section">
                        <div class="pos-section-header" onclick="togglePOSSection('namedEntities')">
                            <span class="pos-section-arrow" id="namedEntities-arrow">â–¼</span>
                            <span style="font-weight: 600;">ğŸ·ï¸ Named Entities</span>
                        </div>
                        <div class="pos-section-content" id="namedEntities-content">
                            <label><input type="checkbox" id="highlightPeople" checked> ğŸ‘¤ People <span class="pos-count" id="countPeople">-</span></label>
                            <label><input type="checkbox" id="highlightPlaces" checked> ğŸ“ Places <span class="pos-count" id="countPlaces">-</span></label>
                        </div>
                    </div>
                    
                    <!-- Special Entities Section -->
                    <div class="pos-section">
                        <div class="pos-section-header" onclick="togglePOSSection('specialEntities')">
                            <span class="pos-section-arrow" id="specialEntities-arrow">â–¼</span>
                            <span style="font-weight: 600;">ğŸ”¢ Special Entities</span>
                        </div>
                        <div class="pos-section-content" id="specialEntities-content">
                            <label><input type="checkbox" id="highlightAbbr"> ğŸ† Abbreviations <span class="pos-count" id="countAbbr">-</span></label>
                            <label><input type="checkbox" id="highlightAcronyms"> ğŸ…°ï¸ Acronyms <span class="pos-count" id="countAcronyms">-</span></label>
                            <label><input type="checkbox" id="highlightNumbers"> ğŸ”¢ Numbers <span class="pos-count" id="countNumbers">-</span></label>
                            <label><input type="checkbox" id="highlightCurrencies"> ğŸ’µ Currencies <span class="pos-count" id="countCurrencies">-</span></label>
                            <label><input type="checkbox" id="highlightDates"> ğŸ“… Dates <span class="pos-count" id="countDates">-</span></label>
                            <label><input type="checkbox" id="highlightCrypto"> ğŸª™ Crypto <span class="pos-count" id="countCrypto">-</span></label>
                            <label><input type="checkbox" id="highlightCurrencyPairs"> ğŸ’± Pairs <span class="pos-count" id="countCurrencyPairs">-</span></label>
                            <label><input type="checkbox" id="highlightCurrencySymbols"> ğŸ’² Symbols <span class="pos-count" id="countCurrencySymbols">-</span></label>
                        </div>
                    </div>
                    
                </div>
                <div class="text-content-wrapper">
                    <div id="highlightedTextContent" class="text-content">
                        <div class="placeholder-text">
                            <p>âœ¨ Analysis will start automatically...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes View -->
            <div id="notesView" class="text-view">
                <div class="notes-toolbar">
                    <div class="notes-selection-controls" style="display: flex; align-items: center; gap: 10px; margin-right: 10px;">
                        <input type="checkbox" id="selectAllNotes" title="Select All">
                        <button id="deleteSelectedNotesBtn" class="btn-note" style="background-color: #ef5350; display: none; padding: 5px 10px;">ğŸ—‘ï¸</button>
                    </div>
                    <button id="addNoteBtn" class="btn-note" disabled>â• Add Note</button>
                    <button id="exportBtn" class="btn-note" style="background-color: #9c27b0;" disabled>ğŸ“¤ Export</button>
                    
                    <div class="notes-search-container">
                        <input type="text" id="notesSearchInput" class="notes-search-input" placeholder="Search notes...">
                    </div>
                    
                    <span class="notes-count">0 notes, 0 highlights</span>
                </div>
                <div class="notes-help-banner" id="notesHelpBanner">
                    ğŸ’¡ <strong>Tip:</strong> Right-click on any selected text to highlight or add notes!
                </div>
                <div class="text-content-wrapper">
                    <div id="notesContent" class="notes-content">
                        <div class="placeholder-text">
                            <p>ğŸ“Œ No notes yet</p>
                            <p style="font-size: 14px; color: #666;">Go to Raw Text or Highlighted view, select text, then right-click</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map View -->
            <div id="mapView" class="text-view">
                <div class="map-toolbar">
                    <div class="zoom-control">
                        <label for="mapZoom">Thumbnail Size:</label>
                        <input type="range" id="mapZoom" min="100" max="400" value="200">
                        <span id="mapZoomValue">200px</span>
                    </div>
                    <div class="zoom-control">
                        <label for="mapFontSize">Text Size:</label>
                        <input type="range" id="mapFontSize" min="3" max="10" value="4" step="0.5">
                        <span id="mapFontSizeValue">4px</span>
                    </div>
                    <div class="zoom-control">
                        <label for="mapFontSelect">Font:</label>
                        <select id="mapFontSelect" style="padding: 2px 5px; border-radius: 4px; border: 1px solid #ccc; font-size: 12px;">
                            <option value="'Segoe UI', sans-serif">Sans-Serif</option>
                            <option value="'Times New Roman', serif">Serif</option>
                            <option value="'Consolas', monospace">Monospace</option>
                            <option value="'Comic Sans MS', 'Chalkboard SE', sans-serif">Casual</option>
                        </select>
                    </div>
                    <div class="continuous-mode-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" class="continuous-mode-checkbox">
                            <span class="slider round"></span>
                        </label>
                        <span class="toggle-label">Continuous</span>
                        
                        <div class="color-picker-container hidden">
                            <div class="color-option selected" data-color="#FFC107" style="background-color: #FFC107;" title="Yellow"></div>
                            <div class="color-option" data-color="#4CAF50" style="background-color: #4CAF50;" title="Green"></div>
                            <div class="color-option" data-color="#2196F3" style="background-color: #2196F3;" title="Blue"></div>
                            <div class="color-option" data-color="#E91E63" style="background-color: #E91E63;" title="Pink"></div>
                            <div class="color-option" data-color="#9C27B0" style="background-color: #9C27B0;" title="Purple"></div>
                        </div>
                    </div>
                    <button class="btn-icon" id="mapSettingsBtn" title="Map Display Settings">âš™ï¸</button>
                </div>

                <!-- Map POS Options (Similar to Analyse Tab) -->
                <div class="highlight-options" style="border-bottom: 1px solid #e0e0e0; padding: 8px 15px; background: #fff;">
                    <label style="font-weight: 600; border-bottom: 1px solid #e0e0e0; padding-bottom: 6px; margin-bottom: 4px; width: 100%;"><input type="checkbox" id="mapHighlightSelectAll"> âœ“ Select All</label>
                    <label><input type="checkbox" id="mapHighlightNouns"> ğŸ”µ Nouns <span class="pos-count" id="mapCountNouns">-</span></label>
                    <label><input type="checkbox" id="mapHighlightVerbs"> ğŸŸ¢ Verbs <span class="pos-count" id="mapCountVerbs">-</span></label>
                    <label><input type="checkbox" id="mapHighlightAdj"> ğŸŸ¡ Adjectives <span class="pos-count" id="mapCountAdj">-</span></label>
                    <label><input type="checkbox" id="mapHighlightAdv"> ğŸŸ  Adverbs <span class="pos-count" id="mapCountAdv">-</span></label>
                    <label><input type="checkbox" id="mapHighlightPrep"> ğŸŸ£ Prepositions <span class="pos-count" id="mapCountPrep">-</span></label>
                    <label><input type="checkbox" id="mapHighlightConj"> ğŸŸ¤ Conjunctions <span class="pos-count" id="mapCountConj">-</span></label>
                    <label><input type="checkbox" id="mapHighlightInterj"> ğŸ”´ Interjections <span class="pos-count" id="mapCountInterj">-</span></label>
                    <label><input type="checkbox" id="mapHighlightDet"> âšª Determiners <span class="pos-count" id="mapCountDet">-</span></label>
                    <label><input type="checkbox" id="mapHighlightPeople"> ğŸ‘¤ People <span class="pos-count" id="mapCountPeople">-</span></label>
                    <label><input type="checkbox" id="mapHighlightPlaces"> ğŸ“ Places <span class="pos-count" id="mapCountPlaces">-</span></label>
                    <label><input type="checkbox" id="mapHighlightAbbr"> ğŸ† Abbreviations <span class="pos-count" id="mapCountAbbr">-</span></label>
                    <label><input type="checkbox" id="mapHighlightAcronyms"> ğŸ…°ï¸ Acronyms <span class="pos-count" id="mapCountAcronyms">-</span></label>
                    <label><input type="checkbox" id="mapHighlightNumbers"> ğŸ”¢ Numbers <span class="pos-count" id="mapCountNumbers">-</span></label>
                    <label><input type="checkbox" id="mapHighlightCurrencies"> ğŸ’µ Currencies <span class="pos-count" id="mapCountCurrencies">-</span></label>
                    <label><input type="checkbox" id="mapHighlightDates"> ğŸ“… Dates <span class="pos-count" id="mapCountDates">-</span></label>
                    <label><input type="checkbox" id="mapHighlightCrypto"> ğŸª™ Crypto <span class="pos-count" id="mapCountCrypto">-</span></label>
                    <label><input type="checkbox" id="mapHighlightCurrencyPairs"> ğŸ’± Pairs <span class="pos-count" id="mapCountCurrencyPairs">-</span></label>
                    <label><input type="checkbox" id="mapHighlightCurrencySymbols"> ğŸ’² Symbols <span class="pos-count" id="mapCountCurrencySymbols">-</span></label>
                </div>
                
                <!-- Map Settings Popup -->
                <div id="mapSettingsPopup" class="text-settings-popup hidden">
                    <div class="settings-header">
                        <h4>ğŸ—ºï¸ Map Display Settings</h4>
                        <button id="closeMapSettingsBtn" class="close-settings-btn">Ã—</button>
                    </div>
                    <div class="settings-body">
                        <div class="setting-group">
                            <label>Text Color:</label>
                            <div class="color-options">
                                <button class="color-btn" data-color="#ccc" style="background: #ccc;" title="Light Gray (Default)"></button>
                                <button class="color-btn" data-color="#999" style="background: #999;" title="Medium Gray"></button>
                                <button class="color-btn" data-color="#666" style="background: #666;" title="Dark Gray"></button>
                                <button class="color-btn" data-color="#333" style="background: #333;" title="Almost Black"></button>
                                <button class="color-btn" data-color="#000" style="background: #000;" title="Black"></button>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label>Text Alignment:</label>
                            <div class="alignment-options">
                                <button class="btn-option" data-align="left" title="Left">â¬…ï¸</button>
                                <button class="btn-option" data-align="center" title="Center">â†•ï¸</button>
                                <button class="btn-option" data-align="right" title="Right">â¡ï¸</button>
                                <button class="btn-option" data-align="justify" title="Justify">â¬Œ</button>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label class="toggle-label-inline">
                                <input type="checkbox" id="mapShowHighlights" checked>
                                <span>Show Highlights</span>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label class="toggle-label-inline">
                                <input type="checkbox" id="mapShowLinks" checked>
                                <span>Show Link Connections</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="text-content-wrapper" style="background-color: #f5f5f7;">
                    <div id="mapGrid" class="map-grid">
                        <div class="placeholder-text">
                            <p>ğŸ—ºï¸ Map View</p>
                            <p style="font-size: 14px; color: #666;">Visualize highlights across pages</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Translate View -->
            <div id="translateView" class="text-view">
                <div class="notes-toolbar">
                    <div class="continuous-mode-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" class="continuous-mode-checkbox">
                            <span class="slider round"></span>
                        </label>
                        <span class="toggle-label">Continuous Mode</span>
                        
                        <div class="color-picker-container hidden">
                            <div class="color-option selected" data-color="#FFC107" style="background-color: #FFC107;" title="Yellow"></div>
                            <div class="color-option" data-color="#4CAF50" style="background-color: #4CAF50;" title="Green"></div>
                            <div class="color-option" data-color="#2196F3" style="background-color: #2196F3;" title="Blue"></div>
                            <div class="color-option" data-color="#E91E63" style="background-color: #E91E63;" title="Pink"></div>
                            <div class="color-option" data-color="#9C27B0" style="background-color: #9C27B0;" title="Purple"></div>
                        </div>
                    </div>
                    
                    <!-- POS Highlighting Toggle for Translate -->
                    <!-- <div class="pos-toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="translatePosToggle" checked>
                            <span class="slider round"></span>
                        </label>
                        <span class="toggle-label">POS Highlighting</span>
                    </div> -->
                    
                    <select id="translateLanguageSelect" class="translation-select" title="Select target language">
                        <option value="">ğŸŒ Select language...</option>
                    </select>
                    <button id="speechSettingsBtn" class="btn-icon" title="Speech Settings" style="margin-right: 5px;">ğŸ”Š</button>
                    <button id="startTranslateBtn" class="btn-note" disabled>â–¶ï¸ Start Translation</button>
                    <button id="cancelTranslateBtn" class="btn-note hidden" style="background: #ef4444;">â¹ï¸ Cancel</button>
                    <button id="loadCachedBtn" class="btn-note hidden" style="background: #10b981;">ğŸ“¥ Load Cached</button>
                    <span id="translateStatus" class="notes-count"></span>
                </div>
                
                <!-- POS Checkboxes for Translate View -->
                <div class="highlight-options" id="translatePosOptions">
                    <label style="font-weight: 600; border-bottom: 1px solid #e0e0e0; padding-bottom: 6px; margin-bottom: 8px; width: 100%;"><input type="checkbox" id="translateHighlightSelectAll" checked> âœ“ Select All</label>
                    
                    <!-- Basic Parts of Speech Section -->
                    <div class="pos-section">
                        <div class="pos-section-header" onclick="togglePOSSection('translateBasicPOS')">
                            <span class="pos-section-arrow" id="translateBasicPOS-arrow">â–¼</span>
                            <span style="font-weight: 600;">ğŸ“š Basic Parts of Speech</span>
                        </div>
                        <div class="pos-section-content" id="translateBasicPOS-content">
                            <label><input type="checkbox" id="translateHighlightNouns" checked> ğŸ”µ Nouns <span class="pos-count" id="translateCountNouns">-</span></label>
                            <label><input type="checkbox" id="translateHighlightVerbs" checked> ğŸŸ¢ Verbs <span class="pos-count" id="translateCountVerbs">-</span></label>
                            <label><input type="checkbox" id="translateHighlightAdj"> ğŸŸ¡ Adjectives <span class="pos-count" id="translateCountAdj">-</span></label>
                            <label><input type="checkbox" id="translateHighlightAdv"> ğŸŸ  Adverbs <span class="pos-count" id="translateCountAdv">-</span></label>
                            <label><input type="checkbox" id="translateHighlightPrep"> ğŸŸ£ Prepositions <span class="pos-count" id="translateCountPrep">-</span></label>
                            <label><input type="checkbox" id="translateHighlightConj"> ğŸŸ¤ Conjunctions <span class="pos-count" id="translateCountConj">-</span></label>
                            <label><input type="checkbox" id="translateHighlightInterj"> ğŸ”´ Interjections <span class="pos-count" id="translateCountInterj">-</span></label>
                            <label><input type="checkbox" id="translateHighlightDet"> âšª Determiners <span class="pos-count" id="translateCountDet">-</span></label>
                        </div>
                    </div>
                    
                    <!-- Named Entities Section -->
                    <div class="pos-section">
                        <div class="pos-section-header" onclick="togglePOSSection('translateNamedEntities')">
                            <span class="pos-section-arrow" id="translateNamedEntities-arrow">â–¼</span>
                            <span style="font-weight: 600;">ğŸ·ï¸ Named Entities</span>
                        </div>
                        <div class="pos-section-content" id="translateNamedEntities-content">
                            <label><input type="checkbox" id="translateHighlightPeople" checked> ğŸ‘¤ People <span class="pos-count" id="translateCountPeople">-</span></label>
                            <label><input type="checkbox" id="translateHighlightPlaces" checked> ğŸ“ Places <span class="pos-count" id="translateCountPlaces">-</span></label>
                        </div>
                    </div>
                    
                    <!-- Special Entities Section -->
                    <div class="pos-section">
                        <div class="pos-section-header" onclick="togglePOSSection('translateSpecialEntities')">
                            <span class="pos-section-arrow" id="translateSpecialEntities-arrow">â–¼</span>
                            <span style="font-weight: 600;">ğŸ”¢ Special Entities</span>
                        </div>
                        <div class="pos-section-content" id="translateSpecialEntities-content">
                            <label><input type="checkbox" id="translateHighlightAbbr"> ğŸ† Abbreviations <span class="pos-count" id="translateCountAbbr">-</span></label>
                            <label><input type="checkbox" id="translateHighlightAcronyms"> ğŸ…°ï¸ Acronyms <span class="pos-count" id="translateCountAcronyms">-</span></label>
                            <label><input type="checkbox" id="translateHighlightNumbers"> ğŸ”¢ Numbers <span class="pos-count" id="translateCountNumbers">-</span></label>
                            <label><input type="checkbox" id="translateHighlightCurrencies"> ğŸ’µ Currencies <span class="pos-count" id="translateCountCurrencies">-</span></label>
                            <label><input type="checkbox" id="translateHighlightDates"> ğŸ“… Dates <span class="pos-count" id="translateCountDates">-</span></label>
                            <label><input type="checkbox" id="translateHighlightCrypto"> ğŸª™ Crypto <span class="pos-count" id="translateCountCrypto">-</span></label>
                            <label><input type="checkbox" id="translateHighlightCurrencyPairs"> ğŸ’± Pairs <span class="pos-count" id="translateCountCurrencyPairs">-</span></label>
                            <label><input type="checkbox" id="translateHighlightCurrencySymbols"> ğŸ’² Symbols <span class="pos-count" id="translateCountCurrencySymbols">-</span></label>
                        </div>
                    </div>
                </div>
                <div id="cachedTranslationsBanner" class="translate-info-banner hidden" style="background: #d1fae5; padding: 10px 15px; border-bottom: 1px solid #6ee7b7; font-size: 13px; color: #065f46;">
                    <div style="font-weight: bold; margin-bottom: 5px;">ğŸ’¾ Cached Translations Available:</div>
                    <div id="cachedTranslationsList" style="margin-top: 5px;"></div>
                </div>
                <div class="translate-info-banner" style="background: #f3e8ff; padding: 10px 15px; border-bottom: 1px solid #d8b4fe; font-size: 13px; color: #6b21a8;">
                    <div style="font-weight: bold; margin-bottom: 5px;">ğŸ’¡ Background Translation:</div>
                    <p style="margin: 0;">Translation runs in the background. You can continue working with the document while it processes. Hover over translated text to see the original.</p>
                </div>
                <div class="text-content-wrapper">
                    <div id="translatedTextContent" class="text-content">
                        <div class="placeholder-text">
                            <p>ğŸŒ Document Translation</p>
                            <p style="font-size: 14px; color: #666;">Select a language and click "Start Translation"</p>
                            <p style="font-size: 12px; color: #999; margin-top: 10px;">Supports 40+ languages including Spanish, French, German, Japanese, Chinese, and all 11 official South African languages (Zulu, Xhosa, Afrikaans, Northern Sotho, and more)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mindmap View -->
            <div id="mindmapView" class="text-view">
                <div id="mindmapContainer" style="width: 100%; height: 100%; overflow: hidden; position: relative; background: #fafafa;">
                    <!-- Canvas will be injected here -->
                </div>
                <div class="mindmap-controls" style="position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 100;">
                    <div class="mindmap-hint" style="background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; margin-right: 10px; display: flex; align-items: center;">
                        Ctrl+Drag to create group â€¢ Right-click to pan â€¢ Wheel to zoom
                    </div>
                    <button id="refreshMindmapBtn" class="btn-icon" title="Refresh Layout" style="background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">ğŸ”„</button>
                </div>
            </div>

            <!-- Figures View -->
            <div id="figuresView" class="text-view">
                <div class="notes-toolbar">
                    <button id="scanFiguresBtn" class="btn-note">ğŸ–¼ï¸ Scan for Figures</button>
                    <span id="figuresCount" class="notes-count">0 found</span>
                </div>
                <div class="figures-help-banner" style="background: #e3f2fd; padding: 10px 15px; border-bottom: 1px solid #bbdefb; font-size: 13px; color: #0d47a1;">
                    <div style="font-weight: bold; margin-bottom: 5px;">ğŸ’¡ How to capture figures:</div>
                    <ul style="margin: 0; padding-left: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <li><strong>ğŸ–¼ï¸ Scan Button:</strong> Detects embedded images (photos).</li>
                        <li><strong>âœ‚ï¸ Snip Tool:</strong> Use the scissors icon in the PDF toolbar to capture tables, charts, or diagrams manually.</li>
                    </ul>
                </div>
                <div class="text-content-wrapper" style="background-color: #f5f5f7;">
                    <div id="figuresGrid" class="map-grid">
                        <div class="placeholder-text">
                            <p>ğŸ–¼ï¸ Figures & Diagrams</p>
                            <p style="font-size: 14px; color: #666;">Click "Scan" to extract images from the PDF</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="resizer" id="resizer2"></div>

        <!-- Right Panel: Statistics (Always Visible) -->
        <div class="stats-panel" id="statsPanel">
            <div class="panel-header">
                <h2 style="display: flex; align-items: center;">
                    <button id="collapseStatsBtn" class="panel-collapse-btn" title="Collapse Statistics">â˜°</button>
                    <span style="flex: 1;">ğŸ“Š Statistics & AI</span>
                </h2>
                <!-- Stats Panel Tabs -->
                <div class="stats-tabs">
                    <button class="stats-tab-btn active" data-stats-tab="overview">ğŸ“Š Statistics</button>
                    <button class="stats-tab-btn" data-stats-tab="ai-analysis">ğŸ¤– AI Analysis</button>
                </div>
            </div>
            
            <!-- Statistics Tab Content -->
            <div class="stats-tab-content active" data-stats-content="overview">
                <div class="stats-container">
                <!-- Search Section -->
                <div class="stats-section search-section">
                    <h3>ğŸ” Find Text</h3>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Enter word or phrase to find..." />
                        <button id="searchBtn" class="btn-search">Search</button>
                    </div>
                    <div id="searchStatus" class="search-status"></div>
                </div>

                    <div class="stats-section">
                        <h3>ğŸ“Š Overview</h3>
                        <div id="overviewStats" class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Total Words</div>
                                <div class="stat-value">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Unique Words</div>
                                <div class="stat-value">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Sentences</div>
                                <div class="stat-value">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Pages</div>
                                <div class="stat-value">-</div>
                            </div>
                        <div class="stat-card" data-tooltip="Approximate U.S. grade level required to understand the text.
â€¢ 5-8: Average (Conversational)
â€¢ 9-12: High School
â€¢ 13+: College/Professional (Complex)">
                            <div class="stat-label">Reading Level â“˜</div>
                            <div class="stat-value" id="gradeLevel">-</div>
                            <div class="stat-sub">Flesch-Kincaid</div>
                        </div>
                        <div class="stat-card" data-tooltip="Estimated time to read the document (based on 200 words/min).">
                            <div class="stat-label">Reading Time â“˜</div>
                            <div class="stat-value" id="readingTime">-</div>
                            <div class="stat-sub">min</div>
                        </div>
                        <div class="stat-card" data-tooltip="Percentage of unique words used.
â€¢ > 50%: High Diversity (Rich Vocabulary)
â€¢ 30-50%: Average
â€¢ < 30%: Repetitive">
                            <div class="stat-label">Vocabulary â“˜</div>
                            <div class="stat-value" id="lexicalDiversity">-</div>
                            <div class="stat-sub">Diversity</div>
                        </div>
                        <div class="stat-card" data-tooltip="Average number of words per sentence.">
                            <div class="stat-label">Sentence Len â“˜</div>
                            <div class="stat-value" id="avgSentenceLength">-</div>
                            <div class="stat-sub">words/sent</div>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>ğŸ” Top Words</h3>
                    <div id="topWordsList" class="entity-list">
                        <div class="placeholder-text">No words analyzed yet</div>
                    </div>
                    <div id="topWordsPagination" class="pagination-controls hidden">
                        <div class="pagination-info"></div>
                        <div class="pagination-buttons">
                            <button class="pagination-btn prev-btn">â—€</button>
                            <button class="pagination-btn next-btn">â–¶</button>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>ğŸ’¡ Unique Insights</h3>
                    <div id="insightsList" class="entity-list">
                        <div class="placeholder-text">No unique words detected</div>
                    </div>
                    <div id="insightsPagination" class="pagination-controls hidden">
                        <div class="pagination-info"></div>
                        <div class="pagination-buttons">
                            <button class="pagination-btn prev-btn">â—€</button>
                            <button class="pagination-btn next-btn">â–¶</button>
                        </div>
                        </div>
                    </div>

                    <div class="stats-section">
                        <h3>ğŸ‘¥ People</h3>
                        <div id="peopleList" class="entity-list">
                            <div class="placeholder-text">No people detected</div>
                        </div>
                    <div id="peoplePagination" class="pagination-controls hidden">
                        <div class="pagination-info"></div>
                        <div class="pagination-buttons">
                            <button class="pagination-btn prev-btn">â—€</button>
                            <button class="pagination-btn next-btn">â–¶</button>
                        </div>
                    </div>
                    </div>

                    <div class="stats-section">
                        <h3>ğŸ“ Places</h3>
                        <div id="placesList" class="entity-list">
                            <div class="placeholder-text">No places detected</div>
                        </div>
                    <div id="placesPagination" class="pagination-controls hidden">
                        <div class="pagination-info"></div>
                        <div class="pagination-buttons">
                            <button class="pagination-btn prev-btn">â—€</button>
                            <button class="pagination-btn next-btn">â–¶</button>
                        </div>
                    </div>
                    </div>

                    <div class="stats-section">
                        <h3>ğŸ”¤ Abbreviations</h3>
                        <div id="abbreviationsList" class="entity-list">
                            <div class="placeholder-text">No abbreviations detected</div>
                        </div>
                    <div id="abbreviationsPagination" class="pagination-controls hidden">
                        <div class="pagination-info"></div>
                        <div class="pagination-buttons">
                            <button class="pagination-btn prev-btn">â—€</button>
                            <button class="pagination-btn next-btn">â–¶</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            
            <!-- AI Analysis Tab Content -->
            <div class="stats-tab-content" data-stats-content="ai-analysis">
                <div style="padding: 16px; overflow-y: auto; height: 100%;">
                    <!-- AI Configuration Section -->
                    <div style="margin-bottom: 20px; background: #f9f9f9; border-radius: 8px; border: 1px solid #e0e0e0; overflow: hidden;">
                        <div style="padding: 12px 15px; background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); cursor: pointer; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #e0e0e0;" id="aiConfigHeader">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span id="aiConfigArrow" style="font-weight: bold; transition: transform 0.2s;">â–¼</span>
                                <h3 style="font-size: 15px; font-weight: 600; margin: 0; color: #333;">âš™ï¸ Configuration</h3>
                            </div>
                            <button id="closeAiConfigBtn" style="background: none; border: none; font-size: 18px; color: #999; cursor: pointer; padding: 0 5px; transition: color 0.2s;" title="Hide configuration" onmouseover="this.style.color='#f44336'" onmouseout="this.style.color='#999'">Ã—</button>
                        </div>
                        <div id="aiConfigContent" style="padding: 15px;">
                        
                        <!-- Provider Selection -->
                        <div style="margin-bottom: 12px;">
                            <label style="display: block; font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 500;">AI Provider:</label>
                            <select id="aiProviderSelect" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px;">
                                <option value="ollama">ğŸ  Local Ollama (FREE, Private, No API key!)</option>
                                <option value="openai">OpenAI GPT-4 (~$0.03/doc)</option>
                                <option value="gemini">Google Gemini (Free online, limited)</option>
                            </select>
                        </div>
                        
                        <!-- OpenAI API Key Section -->
                        <div id="openaiApiKeySection" style="margin-bottom: 12px;">
                            <div style="display: flex; gap: 5px; margin-bottom: 6px;">
                                <input type="password" id="openaiApiKey" placeholder="Enter OpenAI API Key" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;">
                                <button id="saveOpenAIKeyBtn" class="btn-icon" style="padding: 8px 12px; font-size: 12px;" title="Save API Key">ğŸ’¾</button>
                                <button id="testOpenAIKeyBtn" class="btn-icon" style="padding: 8px 12px; font-size: 12px;" title="Test API Key">ğŸ”</button>
                            </div>
                            <a href="https://platform.openai.com/api-keys" target="_blank" style="font-size: 11px; color: #2196f3; text-decoration: none;">Get API key from OpenAI â†’</a>
                        </div>
                        
                        <!-- Gemini API Key Section -->
                        <div id="geminiApiKeySection" style="margin-bottom: 12px; display: none;">
                            <div style="display: flex; gap: 5px; margin-bottom: 6px;">
                                <input type="password" id="geminiApiKey" placeholder="Enter Gemini API Key" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;">
                                <button id="saveGeminiKeyBtn" class="btn-icon" style="padding: 8px 12px; font-size: 12px;" title="Save API Key">ğŸ’¾</button>
                                <button id="testGeminiKeyBtn" class="btn-icon" style="padding: 8px 12px; font-size: 12px;" title="Test API Key">ğŸ”</button>
                            </div>
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" style="font-size: 11px; color: #2196f3; text-decoration: none;">Get free API key from Google AI Studio â†’</a>
                        </div>
                        
                        <!-- Ollama Configuration Section -->
                        <div id="ollamaConfigSection" style="margin-bottom: 12px;">
                            <div style="font-size: 12px; color: #4caf50; margin-bottom: 10px; padding: 10px; background: #e8f5e9; border-radius: 4px; font-weight: 500;">
                                âœ“ No API key needed! Uses your local Ollama installation
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; font-size: 12px; color: #666; margin-bottom: 4px; font-weight: 500;">Endpoint:</label>
                                <input type="text" id="ollamaEndpoint" value="http://localhost:11434" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;">
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; font-size: 12px; color: #666; margin-bottom: 4px; font-weight: 500;">Model:</label>
                                <select id="ollamaModel" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;">
                                    <option value="llama3.2">Llama 3.2 (Recommended)</option>
                                    <option value="llama3.1">Llama 3.1</option>
                                    <option value="llama3">Llama 3</option>
                                    <option value="llama2">Llama 2</option>
                                    <option value="mistral">Mistral</option>
                                    <option value="mixtral">Mixtral</option>
                                    <option value="phi3">Phi-3</option>
                                    <option value="gemma2">Gemma 2</option>
                                    <option value="qwen2.5">Qwen 2.5</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                                <button id="saveOllamaConfigBtn" class="btn-icon" style="flex: 1; padding: 8px; font-size: 12px;">ğŸ’¾ Save Config</button>
                                <button id="testOllamaBtn" class="btn-icon" style="flex: 1; padding: 8px; font-size: 12px;">ğŸ” Test Connection</button>
                            </div>
                            <div style="font-size: 11px; color: #666; line-height: 1.5; padding: 8px; background: white; border-radius: 4px;">
                                <strong>Setup:</strong> <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">ollama serve</code><br>
                                <strong>Install:</strong> <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">ollama pull llama3.2</code><br>
                                <a href="#" id="openOllamaSetupGuide" style="color: #2196f3; text-decoration: none; font-weight: 600; margin-top: 5px; display: inline-block;">ğŸ“– Full Setup Guide (Windows, Mac, Linux) â†’</a>
                            </div>
                        </div>
                        
                        <button id="runAIAnalysisBtn" class="btn-primary" style="width: 100%; padding: 10px; font-size: 14px; margin-bottom: 10px; font-weight: 600;">
                            ğŸš€ Analyze Current File
                        </button>

                        <button id="analyzeFolderBtn" class="btn-primary" style="width: 100%; padding: 10px; font-size: 14px; margin-bottom: 10px; font-weight: 600; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            ğŸ“ Analyze Current Folder
                        </button>

                        <button id="batchAnalyzeBtn" class="btn-primary" style="width: 100%; padding: 10px; font-size: 14px; margin-bottom: 10px; font-weight: 600; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            ğŸ“Š Analyze All Files in Library
                        </button>

                        <div id="aiAnalysisStatus" style="font-size: 12px; color: #666; display: none; padding: 10px; background: #fff3cd; border-radius: 4px; margin-bottom: 10px; border-left: 3px solid #ffc107;">
                            <div id="aiAnalysisProgress"></div>
                        </div>
                        
                        <div id="batchAnalysisStatus" style="font-size: 12px; color: #666; display: none; padding: 10px; background: #e3f2fd; border-radius: 4px; margin-bottom: 10px; border-left: 3px solid #2196f3;">
                            <div id="batchAnalysisProgress"></div>
                            <div id="batchAnalysisDetails" style="margin-top: 8px; font-size: 11px; opacity: 0.8;"></div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- AI Results Content -->
                    <div id="aiAnalysisTabContent">
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <p style="font-size: 18px; margin-bottom: 10px;">ğŸ¤– AI Semantic Analysis</p>
                            <p style="font-size: 14px; line-height: 1.6;">Configure your AI provider above and click <strong>ğŸš€ Analyze Document</strong> to find semantic patterns.<br><br>The AI will find sentences with similar meanings and group them into patterns.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Expand Stats Button (shown when collapsed) -->
        <button id="expandStatsBtn" class="expand-panel-btn hidden" title="Expand Statistics">â˜°</button>
        
        <!-- Resizer on right side of stats panel -->
        <div class="resizer" id="resizer3"></div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <span id="statusMessage">Ready</span>
        </div>
        <div class="status-right">
            <span id="processingTime"></span>
        </div>
    </div>

    <!-- Word Navigation Bar -->
    <div id="wordNavBar" class="word-nav-bar hidden">
        <button id="prevOccurrenceBtn" class="nav-btn">â—€ Previous</button>
        <div class="nav-info">
            <span id="navWordDisplay"></span>
            <div class="nav-occurrence-control">
                Occurrence 
                <input type="number" id="navOccurrenceInput" min="1" value="1" class="nav-input">
                of 
                <span id="navTotalCount">0</span>
            </div>
        </div>
        <button id="nextOccurrenceBtn" class="nav-btn">Next â–¶</button>
        <button id="closeNavBtn" class="nav-close-btn">âœ•</button>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu hidden">
        <!-- Default options -->
        <div class="context-menu-group" id="contextDefaultGroup">
            <div class="context-menu-item" id="contextHighlight">
                ğŸ–ï¸ Highlight Text
            </div>
            <div class="context-menu-item" id="contextAddNote">
                ğŸ“ Add Note
            </div>
        </div>
        
        <!-- Existing Highlight options -->
        <div class="context-menu-group hidden" id="contextHighlightGroup">
            <div class="context-menu-item" id="contextEditNote">
                âœï¸ Edit Note
            </div>
            <div class="context-menu-item delete-item" id="contextDeleteHighlight">
                ğŸ—‘ï¸ Remove Highlight
            </div>
        </div>

        <!-- Translate options -->
        <div class="context-menu-group hidden" id="contextTranslateGroup">
            <div class="context-menu-item" id="contextSpeak">
                ğŸ”Š Speak
            </div>
        </div>
    </div>

    <!-- Note Input Dialog -->
    <div id="noteDialog" class="note-dialog-overlay hidden">
        <div class="note-dialog">
            <div class="note-dialog-header">
                <h3 id="noteDialogTitle">Add Note</h3>
                <button id="noteDialogClose" class="note-dialog-close">Ã—</button>
            </div>
            <div class="note-dialog-body">
                <div id="noteDialogHighlightedText" class="note-dialog-highlighted-text hidden" style="font-style: italic; color: #888; background: #f5f5f5; padding: 12px; border-radius: 6px; margin-bottom: 12px; font-size: 14px; line-height: 1.5; border-left: 3px solid #ccc;">
                    <!-- Highlighted text will be displayed here -->
                </div>
                <textarea id="noteDialogInput" class="note-dialog-textarea" placeholder="Type your note here..."></textarea>
            </div>
            <div class="note-dialog-footer single-button">
                <div class="note-dialog-footer-hint">Press Ctrl+Enter to save</div>
                <div class="note-dialog-footer-actions">
                    <button id="noteDialogSave" class="btn-primary">ğŸ’¾ Save Note</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Appearance Popup -->
    <div id="textSettingsPopup" class="settings-popup hidden">
        <div class="settings-header">
            <h4>Text Appearance</h4>
            <button id="closeSettingsBtn" class="btn-close">Ã—</button>
        </div>
        <div class="settings-group">
            <label>Font Size</label>
            <div class="range-control">
                <span class="range-label-sm">A</span>
                <input type="range" id="fontSizeRange" min="12" max="32" step="1" value="14">
                <span class="range-label-lg">A</span>
            </div>
        </div>
        <div class="settings-group">
            <label>Font Style</label>
            <div class="btn-group font-family-group">
                <button class="btn-option active" data-font="sans">Sans</button>
                <button class="btn-option" data-font="serif" style="font-family: serif;">Serif</button>
                <button class="btn-option" data-font="mono" style="font-family: monospace;">Mono</button>
            </div>
        </div>
        <div class="settings-group">
            <label>Theme</label>
            <div class="theme-options">
                <button class="theme-option active" data-theme="light" style="background: white; border: 1px solid #ddd;" title="Light"></button>
                <button class="theme-option" data-theme="sepia" style="background: #f4ecd8;" title="Sepia"></button>
                <button class="theme-option" data-theme="dark" style="background: #333;" title="Dark"></button>
            </div>
        </div>
    </div>

    <!-- Custom Tooltip -->
    <div id="customTooltip" class="custom-tooltip hidden">
        <div id="tooltipContent" class="tooltip-content"></div>
        <div class="tooltip-arrow"></div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <div id="loadingMessage">Processing...</div>
        <div class="progress-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
    </div>

    <!-- Ollama Setup Guide Dialog -->
    <div id="ollamaSetupDialog" class="note-dialog-overlay hidden">
        <div class="note-dialog" style="max-width: 800px; height: 90vh;">
            <div class="note-dialog-header">
                <h3>ğŸ  Ollama Setup Guide</h3>
                <button class="note-dialog-close" id="closeOllamaSetupDialog">Ã—</button>
            </div>
            <div class="note-dialog-body" style="padding: 20px; overflow-y: auto;">
                <!-- Platform Tabs -->
                <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button id="ollamaTabWindows" class="ollama-platform-tab active" data-platform="windows" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s;">
                        ğŸªŸ Windows
                    </button>
                    <button id="ollamaTabMac" class="ollama-platform-tab" data-platform="mac" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s;">
                        ğŸ macOS
                    </button>
                    <button id="ollamaTabLinux" class="ollama-platform-tab" data-platform="linux" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s;">
                        ğŸ§ Linux
                    </button>
                </div>

                <!-- Benefits Section (Common to all platforms) -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 18px;">âœ¨ Why Use Ollama?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                        <div>
                            <div style="font-size: 24px; margin-bottom: 5px;">ğŸ’°</div>
                            <strong>100% FREE</strong>
                            <div style="font-size: 13px; opacity: 0.9;">No API keys or billing</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; margin-bottom: 5px;">ğŸ”’</div>
                            <strong>PRIVATE</strong>
                            <div style="font-size: 13px; opacity: 0.9;">All data stays local</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; margin-bottom: 5px;">âš¡</div>
                            <strong>POWERFUL</strong>
                            <div style="font-size: 13px; opacity: 0.9;">Works offline</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; margin-bottom: 5px;">ğŸš€</div>
                            <strong>EASY</strong>
                            <div style="font-size: 13px; opacity: 0.9;">5 minute setup</div>
                        </div>
                    </div>
                </div>

                <!-- Windows Instructions -->
                <div id="ollamaPlatformWindows" class="ollama-platform-content">
                    <h4 style="color: #333; margin-top: 0;">ğŸš€ Quick Start (5 Minutes)</h4>
                    
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 1: Install Ollama</strong>
                        <ol style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>Download from <a href="https://ollama.com/download/windows" target="_blank" style="color: #0066cc;">ollama.com/download/windows</a></li>
                            <li>Run the installer (OllamaSetup.exe)</li>
                            <li>Follow the installation wizard</li>
                            <li>Ollama starts automatically after installation!</li>
                        </ol>
                    </div>

                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 2: Pull a Model</strong>
                        <p style="margin: 8px 0;">Open Command Prompt or PowerShell and run:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">ollama pull llama3.2</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">This downloads Llama 3.2 (~2GB). Best for semantic analysis!</p>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #0066cc; font-weight: 600;">Other recommended models</summary>
                            <div style="margin-top: 10px; padding-left: 15px;">
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull mistral</code>
                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Alternative, excellent quality (~4GB)</div>
                                
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull phi3</code>
                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Smaller, faster (~2GB)</div>
                                
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull gemma2</code>
                                <div style="font-size: 12px; color: #666;">Google's model (~3GB)</div>
                            </div>
                        </details>
                    </div>

                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 3: Verify It's Running</strong>
                        <p style="margin: 8px 0;">In Command Prompt or PowerShell:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">ollama list</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">You should see your installed models!</p>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 13px;">
                            <strong>Note:</strong> Ollama usually starts automatically on Windows. If the command doesn't work, run <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">ollama serve</code>
                        </div>
                    </div>

                    <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; border-left: 4px solid #4caf50;">
                        <strong style="color: #2e7d32;">Step 4: Use in Grammar Highlighter</strong>
                        <ol style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>Go to <strong>Statistics & AI â†’ AI Analysis</strong> tab</li>
                            <li>Select <strong>ğŸ  Local Ollama</strong> from the provider dropdown</li>
                            <li>Click <strong>ğŸ” Test Connection</strong> to verify</li>
                            <li>Click <strong>ğŸš€ Analyze Document</strong></li>
                        </ol>
                        <div style="margin-top: 10px; font-size: 18px; text-align: center;">ğŸ‰ Done!</div>
                    </div>

                    <details style="margin-top: 20px;">
                        <summary style="cursor: pointer; color: #0066cc; font-weight: 600; font-size: 15px;">ğŸ› Troubleshooting</summary>
                        <div style="margin-top: 15px; padding-left: 15px;">
                            <div style="margin-bottom: 15px;">
                                <strong>Problem: "Command not found"</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Close and reopen Command Prompt/PowerShell</li>
                                    <li>Restart your computer</li>
                                    <li>Reinstall Ollama from the official website</li>
                                </ul>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Problem: "Cannot connect to Ollama"</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Run: <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">ollama serve</code></li>
                                    <li>Leave the terminal window open</li>
                                    <li>Check if Ollama is running in Task Manager</li>
                                </ul>
                            </div>
                            <div>
                                <strong>Problem: Analysis is slow or crashes</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Use a smaller model like <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">phi3</code></li>
                                    <li>Close other applications to free up RAM</li>
                                    <li>Analyze shorter documents (20-30 sentences at a time)</li>
                                </ul>
                            </div>
                        </div>
                    </details>
                </div>

                <!-- macOS Instructions -->
                <div id="ollamaPlatformMac" class="ollama-platform-content hidden">
                    <h4 style="color: #333; margin-top: 0;">ğŸš€ Quick Start (5 Minutes)</h4>
                    
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 1: Install Ollama</strong>
                        <ol style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>Download from <a href="https://ollama.com/download/mac" target="_blank" style="color: #0066cc;">ollama.com/download/mac</a></li>
                            <li>Open the downloaded .dmg file</li>
                            <li>Drag Ollama to Applications folder</li>
                            <li>Open Ollama from Applications</li>
                            <li>Ollama icon appears in menu bar!</li>
                        </ol>
                    </div>

                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 2: Pull a Model</strong>
                        <p style="margin: 8px 0;">Open Terminal and run:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">ollama pull llama3.2</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">This downloads Llama 3.2 (~2GB). Best for semantic analysis!</p>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #0066cc; font-weight: 600;">Other recommended models</summary>
                            <div style="margin-top: 10px; padding-left: 15px;">
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull mistral</code>
                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Alternative, excellent quality (~4GB)</div>
                                
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull phi3</code>
                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Smaller, faster (~2GB)</div>
                                
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull gemma2</code>
                                <div style="font-size: 12px; color: #666;">Google's model (~3GB)</div>
                            </div>
                        </details>
                    </div>

                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 3: Verify It's Running</strong>
                        <p style="margin: 8px 0;">In Terminal:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">ollama list</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">You should see your installed models!</p>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 13px;">
                            <strong>Tip:</strong> Check the Ollama icon in your menu bar - it should show it's running. If not, open Ollama from Applications.
                        </div>
                    </div>

                    <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; border-left: 4px solid #4caf50;">
                        <strong style="color: #2e7d32;">Step 4: Use in Grammar Highlighter</strong>
                        <ol style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>Go to <strong>Statistics & AI â†’ AI Analysis</strong> tab</li>
                            <li>Select <strong>ğŸ  Local Ollama</strong> from the provider dropdown</li>
                            <li>Click <strong>ğŸ” Test Connection</strong> to verify</li>
                            <li>Click <strong>ğŸš€ Analyze Document</strong></li>
                        </ol>
                        <div style="margin-top: 10px; font-size: 18px; text-align: center;">ğŸ‰ Done!</div>
                    </div>

                    <details style="margin-top: 20px;">
                        <summary style="cursor: pointer; color: #0066cc; font-weight: 600; font-size: 15px;">ğŸ› Troubleshooting</summary>
                        <div style="margin-top: 15px; padding-left: 15px;">
                            <div style="margin-bottom: 15px;">
                                <strong>Problem: "Command not found"</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Make sure Ollama is in your Applications folder</li>
                                    <li>Open Ollama from Applications at least once</li>
                                    <li>Restart Terminal</li>
                                </ul>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Problem: "Cannot connect to Ollama"</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Check if Ollama icon is in the menu bar</li>
                                    <li>Click the icon and make sure it shows "Running"</li>
                                    <li>If not running, open Ollama from Applications</li>
                                </ul>
                            </div>
                            <div>
                                <strong>Problem: Analysis is slow or crashes</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Use a smaller model like <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">phi3</code></li>
                                    <li>Close other applications to free up RAM</li>
                                    <li>Analyze shorter documents (20-30 sentences at a time)</li>
                                    <li>For Apple Silicon Macs: Models run very fast!</li>
                                </ul>
                            </div>
                        </div>
                    </details>
                </div>

                <!-- Linux Instructions -->
                <div id="ollamaPlatformLinux" class="ollama-platform-content hidden">
                    <h4 style="color: #333; margin-top: 0;">ğŸš€ Quick Start (5 Minutes)</h4>
                    
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 1: Install Ollama</strong>
                        <p style="margin: 8px 0;">Open Terminal and run:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">curl -fsSL https://ollama.com/install.sh | sh</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">This installs Ollama automatically. Works on most Linux distributions!</p>
                        <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 13px;">
                            <strong>Alternative:</strong> Manual installation instructions at <a href="https://github.com/ollama/ollama/blob/main/docs/linux.md" target="_blank" style="color: #0066cc;">github.com/ollama/ollama</a>
                        </div>
                    </div>

                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 2: Start Ollama</strong>
                        <p style="margin: 8px 0;">In Terminal:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">ollama serve</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">Keep this terminal window open while using the app.</p>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #0066cc; font-weight: 600;">Run as a system service (optional)</summary>
                            <div style="margin-top: 10px; padding-left: 15px; font-size: 13px;">
                                <p>To run Ollama automatically on startup:</p>
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">sudo systemctl enable ollama</code>
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">sudo systemctl start ollama</code>
                            </div>
                        </details>
                    </div>

                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 3: Pull a Model</strong>
                        <p style="margin: 8px 0;">Open a new Terminal tab and run:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">ollama pull llama3.2</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">This downloads Llama 3.2 (~2GB). Best for semantic analysis!</p>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #0066cc; font-weight: 600;">Other recommended models</summary>
                            <div style="margin-top: 10px; padding-left: 15px;">
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull mistral</code>
                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Alternative, excellent quality (~4GB)</div>
                                
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull phi3</code>
                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Smaller, faster (~2GB)</div>
                                
                                <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 8px; border-radius: 4px; margin: 5px 0;">ollama pull gemma2</code>
                                <div style="font-size: 12px; color: #666;">Google's model (~3GB)</div>
                            </div>
                        </details>
                    </div>

                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="color: #0066cc;">Step 4: Verify It's Running</strong>
                        <p style="margin: 8px 0;">In Terminal:</p>
                        <code style="display: block; background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 8px 0;">ollama list</code>
                        <p style="margin: 8px 0; font-size: 13px; color: #666;">You should see your installed models!</p>
                    </div>

                    <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; border-left: 4px solid #4caf50;">
                        <strong style="color: #2e7d32;">Step 5: Use in Grammar Highlighter</strong>
                        <ol style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>Go to <strong>Statistics & AI â†’ AI Analysis</strong> tab</li>
                            <li>Select <strong>ğŸ  Local Ollama</strong> from the provider dropdown</li>
                            <li>Click <strong>ğŸ” Test Connection</strong> to verify</li>
                            <li>Click <strong>ğŸš€ Analyze Document</strong></li>
                        </ol>
                        <div style="margin-top: 10px; font-size: 18px; text-align: center;">ğŸ‰ Done!</div>
                    </div>

                    <details style="margin-top: 20px;">
                        <summary style="cursor: pointer; color: #0066cc; font-weight: 600; font-size: 15px;">ğŸ› Troubleshooting</summary>
                        <div style="margin-top: 15px; padding-left: 15px;">
                            <div style="margin-bottom: 15px;">
                                <strong>Problem: "Command not found"</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Make sure the installation completed successfully</li>
                                    <li>Try: <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">source ~/.bashrc</code> or restart terminal</li>
                                    <li>Check if ollama is in PATH: <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">which ollama</code></li>
                                </ul>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Problem: "Cannot connect to Ollama"</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Make sure <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">ollama serve</code> is running</li>
                                    <li>Check if the service is running: <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">systemctl status ollama</code></li>
                                    <li>Try restarting: <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">sudo systemctl restart ollama</code></li>
                                </ul>
                            </div>
                            <div>
                                <strong>Problem: Analysis is slow or crashes</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                                    <li>Use a smaller model like <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">phi3</code></li>
                                    <li>Close other applications to free up RAM</li>
                                    <li>Analyze shorter documents (20-30 sentences at a time)</li>
                                    <li>Consider upgrading RAM if analyzing large documents frequently</li>
                                </ul>
                            </div>
                        </div>
                    </details>
                </div>

                <!-- Common FAQ Section -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                    <h4 style="color: #333;">ğŸ’¡ Common Questions</h4>
                    
                    <details style="margin-bottom: 10px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #555;">Which model should I use?</summary>
                        <div style="padding: 10px 15px; font-size: 13px;">
                            <p><strong>Recommended: Mistral</strong> - Best balance of size, speed, and quality</p>
                            <p><strong>Limited RAM?</strong> Use phi3 (smallest, ~2GB)</p>
                            <p><strong>Want best quality?</strong> Use mistral or llama3.1 (larger, ~4GB+)</p>
                        </div>
                    </details>
                    
                    <details style="margin-bottom: 10px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #555;">How much RAM do I need?</summary>
                        <div style="padding: 10px 15px; font-size: 13px;">
                            <p><strong>Minimum:</strong> 8GB RAM for 2GB models</p>
                            <p><strong>Recommended:</strong> 16GB+ RAM for best experience</p>
                            <p>Model size + 4GB = Recommended RAM (e.g., 2GB model needs ~8GB total RAM)</p>
                        </div>
                    </details>
                    
                    <details style="margin-bottom: 10px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #555;">Is my data really private?</summary>
                        <div style="padding: 10px 15px; font-size: 13px;">
                            <p><strong>Yes! 100% private.</strong></p>
                            <p>âœ“ All processing happens on YOUR computer</p>
                            <p>âœ“ No data sent to cloud services</p>
                            <p>âœ“ No internet needed (after downloading models)</p>
                            <p>âœ“ Perfect for confidential documents</p>
                        </div>
                    </details>
                    
                    <details style="margin-bottom: 10px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #555;">How do I update Ollama?</summary>
                        <div style="padding: 10px 15px; font-size: 13px;">
                            <p><strong>Windows/Mac:</strong> Download and run the latest installer from ollama.com</p>
                            <p><strong>Linux:</strong> Run the install script again: <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">curl -fsSL https://ollama.com/install.sh | sh</code></p>
                        </div>
                    </details>
                </div>

                <!-- Additional Resources -->
                <div style="margin-top: 20px; background: #f0f7ff; padding: 15px; border-radius: 6px;">
                    <strong style="color: #0066cc;">ğŸ“š Additional Resources:</strong>
                    <ul style="margin: 10px 0 0 0; padding-left: 20px; font-size: 13px;">
                        <li><a href="https://ollama.com/library" target="_blank" style="color: #0066cc;">Ollama Model Library</a> - Browse all available models</li>
                        <li><a href="https://github.com/ollama/ollama" target="_blank" style="color: #0066cc;">Ollama GitHub</a> - Documentation and support</li>
                        <li><a href="https://discord.gg/ollama" target="_blank" style="color: #0066cc;">Ollama Discord</a> - Community support</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Speech Settings Dialog -->
    <div id="speechSettingsDialog" class="note-dialog-overlay hidden">
        <div class="note-dialog" style="max-width: 500px;">
            <div class="note-dialog-header">
                <h3>ğŸ”Š Text-to-Speech Settings</h3>
                <button class="close-settings-btn" id="closeSpeechSettingsDialog">Ã—</button>
            </div>
            <div class="note-dialog-body" style="padding: 20px;">
                <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 4px; border-left: 4px solid #2196f3;">
                    <p style="margin: 0 0 10px 0; font-weight: 600; color: #0d47a1;">â„¹ï¸ Missing Voices?</p>
                    <p id="voiceInstallInstructions" style="margin: 0; font-size: 0.9em; color: #333;">
                        To get voices for other languages (Russian, Chinese, etc.), you must install the corresponding Language Pack in your system settings.
                    </p>
                    <button id="openWindowsSpeechSettingsBtn" class="btn-secondary hidden" style="margin-top: 10px; font-size: 0.85em;">Open Windows Speech Settings</button>
                    <button id="openMacSpeechSettingsBtn" class="btn-secondary hidden" style="margin-top: 10px; font-size: 0.85em;">Open macOS Speech Settings</button>
                    <div id="linuxVoiceInstructions" class="hidden" style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px; font-size: 0.85em;">
                        <strong>Linux:</strong> Install espeak or speech-dispatcher packages. For better quality voices, install festival or eSpeak NG.
                    </div>
                </div>
                
                <div class="settings-group">
                    <label style="font-weight: 600; display: block; margin-bottom: 8px;">Available Voices:</label>
                    <div id="availableVoicesList" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px; background: #fafafa; font-size: 0.9em; color: #555;">
                        Loading voices...
                    </div>
                </div>
                
                <div class="settings-group" style="margin-top: 15px;">
                    <label style="font-weight: 600; display: block; margin-bottom: 8px;">Test Voice:</label>
                    <div style="display: inline-flex; gap: 10px;">
                        <select id="testVoiceSelect" style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #ccc; width: 90%; "></select>
                        <button id="testVoiceBtn" class="btn-primary" style="margin-top: 8px;">Test</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Dialog -->
    <div id="syncDialog" class="note-dialog-overlay hidden">
        <div class="note-dialog">
            <div class="note-dialog-header">
                <h3>Google Drive Sync</h3>
                <button class="close-settings-btn" id="closeSyncDialog">Ã—</button>
            </div>
            <div class="note-dialog-body" style="padding: 20px;">
                <div id="syncStatusArea">
                    <p id="syncStatusText">Not connected</p>
                    <div style="margin: 10px 0; padding: 10px; background: #e3f2fd; border-radius: 4px; font-size: 13px;">
                        <strong>â„¹ï¸ First time setup?</strong><br>
                        You'll need Google OAuth credentials. See <a href="#" id="setupGuideLink" style="color: #1976d2; text-decoration: underline;">GOOGLE_DRIVE_SETUP.md</a> for detailed instructions.
                    </div>
                    <button id="gdriveLoginBtn" class="btn-primary">Connect Google Drive</button>
                    <button id="gdriveLogoutBtn" class="btn-secondary hidden">Disconnect</button>
                </div>
                
                <div id="syncActions" class="hidden" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                    <h4>ğŸ“ Complete Library Backup</h4>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                        Backup your entire library to Google Drive including:
                        <br>â€¢ ğŸ“‚ Folder structure
                        <br>â€¢ ğŸ“„ All document files
                        <br>â€¢ ğŸ“ Notes and highlights
                        <br>â€¢ ğŸ§  Analysis cache
                    </p>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <button id="syncLibraryUploadBtn" class="btn-primary" style="flex: 1;">ğŸ“¤ Backup Everything to Drive</button>
                            <button id="syncLibraryDownloadBtn" class="btn-secondary" style="flex: 1;">ğŸ“¥ Restore Everything from Drive</button>
                        </div>
                        
                        <!-- Legacy Sync Data (for current document only) -->
                        <details style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                            <summary style="cursor: pointer; font-weight: 600; margin-bottom: 10px; user-select: none;">
                                âš™ï¸ Advanced: Sync Current Document Only
                            </summary>
                            <p style="font-size: 0.9em; color: #666; margin: 10px 0;">
                                Quick sync for just the currently open document (notes, highlights, settings).
                            </p>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <button id="syncUploadBtn" class="btn-primary" style="font-size: 0.9em; padding: 8px 12px;">â¬†ï¸ Upload Current</button>
                                <button id="syncDownloadBtn" class="btn-secondary" style="font-size: 0.9em; padding: 8px 12px;">â¬‡ï¸ Download Current</button>
                            </div>
                            <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; font-size: 0.85em;">
                                <input type="checkbox" id="syncDocumentsCheck" checked> 
                                Also upload current document file
                            </label>
                        </details>
                        <div id="librarySyncProgress" class="hidden" style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                            <div style="font-size: 0.9em;" id="librarySyncStatus">Preparing...</div>
                            <div style="margin-top: 5px;">
                                <div style="background: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div id="librarySyncProgressBar" style="background: #4CAF50; height: 100%; width: 0%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="lastSyncTime" style="margin-top: 10px; font-size: 0.85em; color: #888;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- YouTube Import Modal -->
    <div id="youtubeImportModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h3>ğŸ¥ Import YouTube Transcript</h3>
                <button id="closeYoutubeModal" class="modal-close-btn">Ã—</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #666; font-size: 0.95em;">
                    Enter a YouTube video URL to import its transcript for analysis.
                </p>
                
                <div class="form-group">
                    <label for="youtubeUrlInput">YouTube Video URL:</label>
                    <input type="text" id="youtubeUrlInput" class="text-input" placeholder="https://www.youtube.com/watch?v=..." style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                    <div style="margin-top: 8px; font-size: 0.85em; color: #888;">
                        Examples: youtube.com/watch?v=..., youtu.be/..., or just the video ID
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="youtubeLangSelect">Caption Language:</label>
                    <select id="youtubeLangSelect" class="select-input" style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="it">Italian</option>
                        <option value="pt">Portuguese</option>
                        <option value="ru">Russian</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="zh">Chinese</option>
                        <option value="ar">Arabic</option>
                        <option value="hi">Hindi</option>
                    </select>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="includeTimestampsCheck">
                        Include timestamps in transcript
                    </label>
                </div>
                
                <div id="youtubeImportProgress" class="hidden" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px;">
                    <div style="font-size: 0.9em; margin-bottom: 8px;" id="youtubeImportStatus">Fetching video information...</div>
                    <div style="background: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="youtubeImportProgressBar" style="background: #4CAF50; height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                </div>
                
                <div id="youtubeImportError" class="hidden" style="margin-top: 15px; padding: 12px; background: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33;">
                    <!-- Error message will appear here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelYoutubeImport" class="btn-secondary">Cancel</button>
                <button id="confirmYoutubeImport" class="btn-primary">Import Transcript</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.4/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/epubjs@0.3.93/dist/epub.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    
    <!-- Prism.js Core and Language Support -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-tsx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-csharp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-rust.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-ruby.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-swift.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-kotlin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-scss.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sass.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-gdscript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-glsl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-lua.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-dart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-elixir.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-erlang.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-clojure.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-lisp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-scheme.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>
    
    <script src="../lib/compromise.js"></script>
    <script src="components/pdf-viewer.js"></script>
    <script src="components/epub-reader.js"></script>
    <script src="components/docx-reader.js"></script>
    <script src="components/markdown-reader.js"></script>
    <script src="components/txt-reader.js"></script>
    <script src="components/code-reader.js"></script>
    <script src="components/url-reader.js"></script>
    <script src="components/youtube-transcript-reader.js"></script>
    <script src="components/dictionary-service.js"></script>
    <script src="components/text-analyzer.js"></script>
    <script src="components/stats-panel.js"></script>
    <script src="components/analysis-cache.js"></script>
    <script src="components/translation-service.js"></script>
    <script src="components/translation-cache.js"></script>
    <script src="components/notes-manager.js"></script>
    <script src="components/figures-manager.js"></script>
    <script src="components/tab-manager.js"></script>
    <script src="components/library-manager.js"></script>
    <script src="components/library-ui.js"></script>
    <script src="components/youtube-transcript-reader.js"></script>
    <script src="components/mindmap-manager.js"></script>
    <script src="components/ai-semantic-analyzer.js"></script>
    <script src="renderer.js"></script>
</body>
</html>

